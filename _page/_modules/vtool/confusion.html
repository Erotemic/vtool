

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>vtool.confusion &mdash; vtool 1.0.1.dev1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="vtool 1.0.1.dev1 documentation" href="../../index.html"/>
        <link rel="up" title="vtool" href="../vtool.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> vtool
          

          
          </a>

          
            
            
              <div class="version">
                1.0.1.dev1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../vtool.html">vtool package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">vtool</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../vtool.html">vtool</a> &raquo;</li>
      
    <li>vtool.confusion</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for vtool.confusion</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for -- Confusion matrix, contingency, error matrix,</span>

<span class="sd">References:</span>
<span class="sd">    http://en.wikipedia.org/wiki/Confusion_matrix</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span>
<span class="p">(</span><span class="k">print</span><span class="p">,</span> <span class="n">print_</span><span class="p">,</span> <span class="n">printDBG</span><span class="p">,</span> <span class="n">rrr</span><span class="p">,</span> <span class="n">profile</span><span class="p">)</span> <span class="o">=</span> <span class="n">ut</span><span class="o">.</span><span class="n">inject</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;[confusion]&#39;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<div class="viewcode-block" id="testdata_scores_labels"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.testdata_scores_labels">[docs]</a><span class="k">def</span> <span class="nf">testdata_scores_labels</span><span class="p">():</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">89</span><span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">scores</span><span class="p">,</span> <span class="n">labels</span>

</div>
<div class="viewcode-block" id="interpolate_replbounds"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.interpolate_replbounds">[docs]</a><span class="k">def</span> <span class="nf">interpolate_replbounds</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    xdata = np.array([.1, .2, .3, .4, .5])</span>
<span class="sd">    ydata = np.array([.1, .2, .3, .4, .5])</span>
<span class="sd">    pt = .35</span>

<span class="sd">    FIXME:</span>
<span class="sd">        if duplicate xdata is given bad things happen.</span>
<span class="sd">    BUG:</span>
<span class="sd">        in scipy.interpolate.interp1d</span>
<span class="sd">        If there is a duplicate xdata, then assume_sorted=False will</span>
<span class="sd">        sort ydata by xdata, but xdata should retain its initial ordering</span>
<span class="sd">        in places of ambuguity. Currently it does not.</span>
<span class="sd">    Args:</span>
<span class="sd">        xdata (ndarray):</span>
<span class="sd">        ydata (ndarray):</span>
<span class="sd">        pt (ndarray):</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: interp_vals</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion --exec-interpolate_replbounds</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; xdata = np.array([0.7,  0.8,  0.8,  0.9,  0.9, 0.9])</span>
<span class="sd">        &gt;&gt;&gt; ydata = np.array([34,    26,   23,   22,   19,  17])</span>
<span class="sd">        &gt;&gt;&gt; pt = np.array([.85, 1.0, -1.0])</span>
<span class="sd">        &gt;&gt;&gt; interp_vals = interpolate_replbounds(xdata, ydata, pt)</span>
<span class="sd">        &gt;&gt;&gt; result = (&#39;interp_vals = %s&#39; % (str(interp_vals),))</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        interp_vals = [ 22.5  17.   34. ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">issorted</span><span class="p">(</span><span class="n">xdata</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s">&#39;need to sort xdata and ydata in function&#39;</span><span class="p">)</span>
        <span class="n">sortx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xdata</span><span class="p">)),</span> <span class="n">xdata</span><span class="p">]))</span>
        <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">sortx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">sortx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">is_scalar</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ut</span><span class="o">.</span><span class="n">isiterable</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
    <span class="c">#print(&#39;----&#39;)</span>
    <span class="c">#print(&#39;xdata = %r&#39; % (xdata,))</span>
    <span class="c">#print(&#39;ydata = %r&#39; % (ydata,))</span>
    <span class="k">if</span> <span class="n">is_scalar</span><span class="p">:</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt</span><span class="p">])</span>
    <span class="c">#ut.ensure_iterable(pt)</span>
    <span class="n">minval</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">argx_min_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">xdata</span> <span class="o">==</span> <span class="n">minval</span><span class="p">)</span>
    <span class="n">argx_max_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">xdata</span> <span class="o">==</span> <span class="n">maxval</span><span class="p">)</span>
    <span class="n">argx_min</span> <span class="o">=</span> <span class="n">argx_min_list</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">argx_max</span> <span class="o">=</span> <span class="n">argx_max_list</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">lower_mask</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">&lt;</span> <span class="n">xdata</span><span class="p">[</span><span class="n">argx_min</span><span class="p">]</span>
    <span class="n">upper_mask</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">&gt;</span> <span class="n">xdata</span><span class="p">[</span><span class="n">argx_max</span><span class="p">]</span>
    <span class="n">interp_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">lower_mask</span><span class="p">,</span> <span class="n">upper_mask</span><span class="p">)</span>
    <span class="c">#if isinstance(pt, np.ndarray):</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">result_type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">ydata</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">interp_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">interp_vals</span><span class="p">[</span><span class="n">lower_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="n">argx_min</span><span class="p">]</span>
    <span class="n">interp_vals</span><span class="p">[</span><span class="n">upper_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="n">argx_max</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">interp_mask</span><span class="p">):</span>
        <span class="c"># FIXME: allow assume_sorted = False</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="n">assume_sorted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">interp_vals</span><span class="p">[</span><span class="n">interp_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">interp_mask</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">is_scalar</span><span class="p">:</span>
        <span class="n">interp_vals</span> <span class="o">=</span> <span class="n">interp_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c"># interpolate to target recall</span>
    <span class="c">#right_index  = indicies[0]</span>
    <span class="c">#right_recall = self.recall[right_index]</span>
    <span class="c">#left_index   = right_index - 1</span>
    <span class="c">#left_recall  = self.recall[left_index]</span>
    <span class="c">#stepsize = right_recall - left_recall</span>
    <span class="c">#alpha = (target_recall - left_recall) / stepsize</span>
    <span class="c">#left_fpr   = self.fpr[left_index]</span>
    <span class="c">#right_fpr  = self.fpr[right_index]</span>
    <span class="c">#interp_fpp = (left_fpr * (1 - alpha)) + (right_fpr * (alpha))</span>
    <span class="k">return</span> <span class="n">interp_vals</span>

</div>
<span class="nd">@six.add_metaclass</span><span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">ReloadingMetaclass</span><span class="p">)</span>
<div class="viewcode-block" id="ConfusionMetrics"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics">[docs]</a><span class="k">class</span> <span class="nc">ConfusionMetrics</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ignore:</span>
<span class="sd">        varname_list = &#39;tp, fp, fn, tn, fpr, tpr, ppv&#39;.split(&#39;, &#39;)</span>
<span class="sd">        lines = [&#39;self.{varname} = {varname}&#39;.format(varname=varname) for varname in varname_list]</span>
<span class="sd">        print(ut.indent(&#39;\n&#39;.join(lines)))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">ppv</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tp</span> <span class="o">=</span> <span class="n">tp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tn</span> <span class="o">=</span> <span class="n">tn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpr</span> <span class="o">=</span> <span class="n">fpr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpr</span> <span class="o">=</span> <span class="n">tpr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ppv</span> <span class="o">=</span> <span class="n">ppv</span>

    <span class="c"># --------------</span>
    <span class="c"># Construtors</span>
    <span class="c"># --------------</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfusionMetrics.from_scores_and_labels"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.from_scores_and_labels">[docs]</a>    <span class="k">def</span> <span class="nf">from_scores_and_labels</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">get_confusion_metrics</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfusionMetrics.get_confusion_metrics"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_confusion_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">get_confusion_metrics</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">get_confusion_metrics</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ConfusionMetrics.from_tp_and_tn_scores"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.from_tp_and_tn_scores">[docs]</a>    <span class="k">def</span> <span class="nf">from_tp_and_tn_scores</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">tp_scores</span><span class="p">,</span> <span class="n">tn_scores</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">tp_scores</span><span class="p">,</span> <span class="n">tn_scores</span><span class="p">])</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp_scores</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tn_scores</span><span class="p">))</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">get_confusion_metrics</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c"># --------------</span>
    <span class="c"># Visualizations</span>
    <span class="c"># --------------</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.draw_roc_curve"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.draw_roc_curve">[docs]</a>    <span class="k">def</span> <span class="nf">draw_roc_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">draw_roc_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.draw_precision_recall_curve"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.draw_precision_recall_curve">[docs]</a>    <span class="k">def</span> <span class="nf">draw_precision_recall_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nSamples</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span>
        <span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span> <span class="o">=</span> <span class="n">interpolate_precision_recall</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">draw_precision_recall_curve</span><span class="p">(</span><span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.get_fpr_at_95_recall"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_fpr_at_95_recall">[docs]</a>    <span class="k">def</span> <span class="nf">get_fpr_at_95_recall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target_recall</span> <span class="o">=</span> <span class="o">.</span><span class="mi">95</span>
        <span class="n">fpr95</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fpr_at_recall</span><span class="p">(</span><span class="n">target_recall</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fpr95</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.get_fpr_at_recall"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_fpr_at_recall">[docs]</a>    <span class="k">def</span> <span class="nf">get_fpr_at_recall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_recall</span><span class="p">):</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span> <span class="o">&gt;=</span> <span class="n">target_recall</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indicies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;no recall at target level&#39;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recall</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpr</span><span class="p">)</span>
        <span class="n">interp_fpr</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">target_recall</span><span class="p">)</span>
        <span class="c">## interpolate to target recall</span>
        <span class="c">#right_index  = indicies[0]</span>
        <span class="c">#right_recall = self.recall[right_index]</span>
        <span class="c">#left_index   = right_index - 1</span>
        <span class="c">#left_recall  = self.recall[left_index]</span>
        <span class="c">#stepsize = right_recall - left_recall</span>
        <span class="c">#alpha = (target_recall - left_recall) / stepsize</span>
        <span class="c">#left_fpr   = self.fpr[left_index]</span>
        <span class="c">#right_fpr  = self.fpr[right_index]</span>
        <span class="c">#interp_fpp = (left_fpr * (1 - alpha)) + (right_fpr * (alpha))</span>
        <span class="k">return</span> <span class="n">interp_fpr</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.get_recall_at_fpr"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_recall_at_fpr">[docs]</a>    <span class="k">def</span> <span class="nf">get_recall_at_fpr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_fpr</span><span class="p">):</span>
        <span class="n">indicies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpr</span> <span class="o">&gt;=</span> <span class="n">target_fpr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">indicies</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;no false positives at target level&#39;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpr</span><span class="p">)</span>
        <span class="n">interp_tpr</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">target_fpr</span><span class="p">)</span>
        <span class="c">## interpolate to target recall</span>
        <span class="c">#right_index  = indicies[0]</span>
        <span class="c">#right_recall = self.recall[right_index]</span>
        <span class="c">#left_index   = right_index - 1</span>
        <span class="c">#left_recall  = self.recall[left_index]</span>
        <span class="c">#stepsize = right_recall - left_recall</span>
        <span class="c">#alpha = (target_recall - left_recall) / stepsize</span>
        <span class="c">#left_fpr   = self.fpr[left_index]</span>
        <span class="c">#right_fpr  = self.fpr[right_index]</span>
        <span class="c">#interp_fpp = (left_fpr * (1 - alpha)) + (right_fpr * (alpha))</span>
        <span class="k">return</span> <span class="n">interp_tpr</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.get_threshold_at_metric"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_threshold_at_metric">[docs]</a>    <span class="k">def</span> <span class="nf">get_threshold_at_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Gets a threshold for a binary classifier using a target metric and value</span>

<span class="sd">        Args:</span>
<span class="sd">            metric (str): tpr or fpr</span>
<span class="sd">            value (float): corresponding numeric value</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: thresh</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m vtool.confusion --exec-get_threshold_at_metric</span>
<span class="sd">            python -m vtool.confusion --exec-interact_roc_factory --show</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">            &gt;&gt;&gt; self = get_confusion_metrics(scores, labels)</span>
<span class="sd">            &gt;&gt;&gt; metric = &#39;tpr&#39;</span>
<span class="sd">            &gt;&gt;&gt; value = .85</span>
<span class="sd">            &gt;&gt;&gt; thresh = self.get_threshold_at_metric(metric, value)</span>
<span class="sd">            &gt;&gt;&gt; print(&#39;%s = %r&#39; % (metric, value,))</span>
<span class="sd">            &gt;&gt;&gt; result = (&#39;thresh = %s&#39; % (str(thresh),))</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">            thresh = 22.5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: Use interpoloation here and make tpr vs fpr a smooth funciton</span>
        <span class="n">metric_values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
        <span class="n">thresh</span> <span class="o">=</span> <span class="n">interpolate_replbounds</span><span class="p">(</span><span class="n">metric_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c">#try:</span>
        <span class="c">#    if metric_values[0] &gt; metric_values[-1]:</span>
        <span class="c">#        index = np.nonzero(metric_values &lt;= value)[0][0]</span>
        <span class="c">#    else:</span>
        <span class="c">#        index = np.nonzero(metric_values &gt;= value)[0][0]</span>
        <span class="c">#except IndexError:</span>
        <span class="c">#    index = len(self.thresholds) - 1</span>
        <span class="c">#thresh = self.thresholds[index]</span>
        <span class="k">return</span> <span class="n">thresh</span>
</div>
<div class="viewcode-block" id="ConfusionMetrics.get_metric_at_threshold"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_metric_at_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">get_metric_at_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">thresh</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            metric (str):</span>
<span class="sd">            thresh (float):</span>

<span class="sd">        Returns:</span>
<span class="sd">            float : value</span>

<span class="sd">        CommandLine:</span>
<span class="sd">            python -m vtool.confusion --exec-get_metric_at_threshold</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">            &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">            &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">            &gt;&gt;&gt; self = get_confusion_metrics(scores, labels)</span>
<span class="sd">            &gt;&gt;&gt; metric = &#39;tpr&#39;</span>
<span class="sd">            &gt;&gt;&gt; thresh = .8</span>
<span class="sd">            &gt;&gt;&gt; (None, None) = self.get_metric_at_threshold(metric, thresh)</span>
<span class="sd">            &gt;&gt;&gt; result = (&#39;(None, None) = %s&#39; % (str((None, None)),))</span>
<span class="sd">            &gt;&gt;&gt; print(result)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Assert decreasing</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span> <span class="o">&lt;=</span> <span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">metric</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">value</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppv</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpr</span>

<div class="viewcode-block" id="ConfusionMetrics.get_ave_precision"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.ConfusionMetrics.get_ave_precision">[docs]</a>    <span class="k">def</span> <span class="nf">get_ave_precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall</span>
        <span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span> <span class="o">=</span> <span class="n">interpolate_precision_recall</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_interp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">p_interp</span><span class="o">.</span><span class="n">size</span>
</div>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">auc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The AUC is a standard measure used to evaluate a binary classifier and</span>
<span class="sd">          represents the probability that a random correct case will</span>
<span class="sd">          receive a higher score than a random incorrect case.</span>

<span class="sd">        References:</span>
<span class="sd">            https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Area_under_the_curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fpr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tpr</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="interpolate_precision_recall"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.interpolate_precision_recall">[docs]</a><span class="k">def</span> <span class="nf">interpolate_precision_recall</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">nSamples</span><span class="o">=</span><span class="mi">11</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolates precision as a function of recall p_{interp}(r)</span>

<span class="sd">    Reduce wiggles in average precision curve by taking interpolated values</span>
<span class="sd">    along a uniform sample.</span>

<span class="sd">    References:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Information_retrieval#Average_precision</span>
<span class="sd">        http://en.wikipedia.org/wiki/Information_retrieval#Mean_Average_precision</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion --test-interpolate_precision_recall --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">        &gt;&gt;&gt; nSamples = 11</span>
<span class="sd">        &gt;&gt;&gt; confusions = get_confusion_metrics(scores, labels)</span>
<span class="sd">        &gt;&gt;&gt; precision = confusions.precision</span>
<span class="sd">        &gt;&gt;&gt; recall = confusions.recall</span>
<span class="sd">        &gt;&gt;&gt; recall_domain, p_interp = interpolate_precision_recall(confusions.precision, recall, nSamples=11)</span>
<span class="sd">        &gt;&gt;&gt; result = ut.numpy_str(p_interp, precision=1)</span>
<span class="sd">        &gt;&gt;&gt; print(result)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; draw_precision_recall_curve(recall_domain, p_interp)</span>
<span class="sd">        &gt;&gt;&gt; ut.show_if_requested()</span>
<span class="sd">        np.array([ 1. ,  1. ,  1. ,  1. ,  1. ,  1. ,  1. ,  0.9,  0.9,  0.8,  0.6], dtype=np.float64)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="n">recall_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nSamples</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c"># normal interpolation</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span>
                                          <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                          <span class="n">fill_value</span><span class="o">=</span><span class="n">precision</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">p_interp</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">recall_domain</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Pascal interpolation</span>
        <span class="c">#candidate_masks = recall &gt;= recall_domain[:, None]</span>
        <span class="c">#candidates_idxs_ = [np.where(mask)[0] for mask in candidate_masks]</span>
        <span class="c">#chosen_idx = [-1 if len(idxs) == 0 else idxs.min() for idxs in  candidates_idxs_]</span>
        <span class="c">#p_interp = precision[chosen_idx]</span>
        <span class="k">def</span> <span class="nf">p_interp</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
            <span class="n">precision_candidates</span> <span class="o">=</span> <span class="n">precision</span><span class="p">[</span><span class="n">recall</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">precision_candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">precision_candidates</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">p_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p_interp</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">recall_domain</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span>

</div>
<div class="viewcode-block" id="get_confusion_metrics"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.get_confusion_metrics">[docs]</a><span class="k">def</span> <span class="nf">get_confusion_metrics</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    gets average percision using the PASCAL definition</span>

<span class="sd">    FIXME: Use only the groundtruth that could have been matched in the</span>
<span class="sd">    database. (shouldn&#39;t be an issue until we start using daid subsets)</span>

<span class="sd">    References:</span>
<span class="sd">        http://en.wikipedia.org/wiki/Information_retrieval</span>
<span class="sd">        http://en.wikipedia.org/wiki/Precision_and_recall</span>
<span class="sd">        http://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_curve.html#sklearn.metrics.roc_curve</span>

<span class="sd">    SeeAlso:</span>
<span class="sd">        sklearn.metrics.ranking._binary_clf_curve</span>

<span class="sd">    Notes:</span>
<span class="sd">        From oxford:</span>
<span class="sd">        Precision is defined as the ratio of retrieved positive images to the</span>
<span class="sd">          total number retrieved.</span>
<span class="sd">        Recall is defined as the ratio of the number of retrieved positive</span>
<span class="sd">          images to the total number of positive images in the corpus.</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion --exec-get_confusion_metrics --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # ENABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">        &gt;&gt;&gt; confusions = get_confusion_metrics(scores, labels)</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; confusions.draw_roc_curve()</span>
<span class="sd">        &gt;&gt;&gt; ut.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sklearn.metrics</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[confusion] building confusion metrics.&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[confusion]  * scores.shape=</span><span class="si">%r</span><span class="s">, scores.dtype=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">scores</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[confusion]  * labels.shape=</span><span class="si">%r</span><span class="s">, labels.dtype=</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[confusion]  * size(scores) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_object_size_str</span><span class="p">(</span><span class="n">scores</span><span class="p">),))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;[confusion]  * size(labels) = </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ut</span><span class="o">.</span><span class="n">get_object_size_str</span><span class="p">(</span><span class="n">labels</span><span class="p">),))</span>

    <span class="c"># TODO</span>
    <span class="c">#sklearn.metrics.precision_recall_curve(labels, probs)</span>
    <span class="c">#sklearn.metrics.classification_report</span>

    <span class="c"># sklearn has much faster implementation</span>
    <span class="c"># fp - count the number of false positives with score &gt;= threshold[i]</span>
    <span class="c"># tp - count the number of true positives with score &gt;= threshold[i]</span>
    <span class="n">fp</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">_binary_clf_curve</span><span class="p">(</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">nGroundTruth</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">nGroundTruth</span> <span class="o">-</span> <span class="n">tp</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">nGroundTruth</span> <span class="o">-</span> <span class="n">fp</span>

    <span class="n">fpr</span> <span class="o">=</span> <span class="n">fp</span> <span class="o">/</span> <span class="n">fp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="n">tp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="c"># TODO: if this breaks check implmentation in</span>
        <span class="n">fpr_curve</span><span class="p">,</span> <span class="n">tpr_curve</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_curve</span><span class="p">(</span>
            <span class="n">labels</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">fpr_curve</span> <span class="o">==</span> <span class="n">fpr</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tpr_curve</span> <span class="o">==</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_precision</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; precision -- positive predictive value (PPV) &quot;&quot;&quot;</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
        <span class="c">#precision = np.nan_to_num(precision)</span>
        <span class="k">return</span> <span class="n">precision</span>

    <span class="n">ppv</span> <span class="o">=</span> <span class="n">precision</span> <span class="o">=</span> <span class="n">get_precision</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">precision</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">confusions</span> <span class="o">=</span> <span class="n">ConfusionMetrics</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">ppv</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">confusions</span>

</div>
<div class="viewcode-block" id="interact_roc_factory"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.interact_roc_factory">[docs]</a><span class="k">def</span> <span class="nf">interact_roc_factory</span><span class="p">(</span><span class="n">confusions</span><span class="p">,</span> <span class="n">target_tpr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">show_operating_point</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        confusions (Confusions):</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion --exec-interact_roc_factory --show</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;scores = %r&#39; % (scores,))</span>
<span class="sd">        &gt;&gt;&gt; confusions = get_confusion_metrics(scores, labels)</span>
<span class="sd">        &gt;&gt;&gt; print(ut.make_csv_table(</span>
<span class="sd">        &gt;&gt;&gt;   [confusions.fpr, confusions.tpr, confusions.thresholds],</span>
<span class="sd">        &gt;&gt;&gt;   [&#39;fpr&#39;, &#39;tpr&#39;, &#39;thresh&#39;]))</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; ROCInteraction = interact_roc_factory(confusions, target_tpr=.4, show_operating_point=True)</span>
<span class="sd">        &gt;&gt;&gt; inter = ROCInteraction()</span>
<span class="sd">        &gt;&gt;&gt; inter.show_page()</span>
<span class="sd">        &gt;&gt;&gt; ut.quit_if_noshow()</span>
<span class="sd">        &gt;&gt;&gt; import plottool as pt</span>
<span class="sd">        &gt;&gt;&gt; ut.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">plottool.abstract_interaction</span> <span class="kn">import</span> <span class="n">AbstractInteraction</span>

    <span class="k">class</span> <span class="nc">ROCInteraction</span><span class="p">(</span><span class="n">AbstractInteraction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        References:</span>
<span class="sd">            http://scipy-central.org/item/38/1/roc-curve-demo</span>

<span class="sd">        Notes:</span>
<span class="sd">            Sensitivity = true positive rate</span>
<span class="sd">            Specificity = true negative rate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;ROC Interact&#39;</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ROCInteraction</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confusions</span> <span class="o">=</span> <span class="n">confusions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_fpr</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_operating_point</span> <span class="o">=</span> <span class="n">show_operating_point</span>

        <span class="nd">@staticmethod</span>
        <span class="k">def</span> <span class="nf">static_plot</span><span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c">#print(&#39;ROC Interact2&#39;)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;thresholds&#39;</span><span class="p">,</span> <span class="n">confusions</span><span class="o">.</span><span class="n">thresholds</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show_operating_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;show_operating_point&#39;</span><span class="p">,</span>
                                                        <span class="n">show_operating_point</span><span class="p">)</span>
            <span class="c">#ut.embed()</span>
            <span class="n">confusions</span><span class="o">.</span><span class="n">draw_roc_curve</span><span class="p">(</span><span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
                                      <span class="n">target_tpr</span><span class="o">=</span><span class="n">target_tpr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="p">):</span>
            <span class="c">#print(&#39;ROC Interact3&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">static_plot</span><span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="p">,</span> <span class="n">target_fpr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_fpr</span><span class="p">,</span>
                             <span class="n">show_operating_point</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show_operating_point</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_click_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">ex</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_fpr</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_page</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">on_drag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="c"># FIXME: blit</span>
            <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
                <span class="c">#print(&#39;Dragging &#39; + str(event.x) + &#39; &#39; + str(event.y))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_fpr</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_page</span><span class="p">()</span>
                <span class="c">#self.draw()</span>
                <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
                    <span class="c">#[blit(ax) event.canvas.figure.axes]</span>

    <span class="k">return</span> <span class="n">ROCInteraction</span>

</div>
<div class="viewcode-block" id="draw_roc_curve"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.draw_roc_curve">[docs]</a><span class="k">def</span> <span class="nf">draw_roc_curve</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">target_tpr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">target_fpr</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">thresholds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">show_operating_point</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        fpr (?):</span>
<span class="sd">        tpr (?):</span>
<span class="sd">        fnum (int):  figure number(default = None)</span>
<span class="sd">        pnum (tuple):  plot number(default = None)</span>
<span class="sd">        marker (str): (default = &#39;-x&#39;)</span>
<span class="sd">        target_tpr (None): (default = None)</span>
<span class="sd">        target_fpr (None): (default = None)</span>
<span class="sd">        thresholds (None): (default = None)</span>
<span class="sd">        color (None): (default = None)</span>
<span class="sd">        show_operating_point (bool): (default = False)</span>

<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion --exec-draw_roc_curve --show --lightbg</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # DISABLE_DOCTEST</span>
<span class="sd">        &gt;&gt;&gt; from vtool.confusion import *  # NOQA</span>
<span class="sd">        &gt;&gt;&gt; scores, labels = testdata_scores_labels()</span>
<span class="sd">        &gt;&gt;&gt; confusions = get_confusion_metrics(scores, labels)</span>
<span class="sd">        &gt;&gt;&gt; fpr = confusions.fpr</span>
<span class="sd">        &gt;&gt;&gt; tpr = confusions.tpr</span>
<span class="sd">        &gt;&gt;&gt; thresholds = confusions.thresholds</span>
<span class="sd">        &gt;&gt;&gt; fnum = None</span>
<span class="sd">        &gt;&gt;&gt; pnum = None</span>
<span class="sd">        &gt;&gt;&gt; marker = &#39;-x&#39;</span>
<span class="sd">        &gt;&gt;&gt; target_tpr = .85</span>
<span class="sd">        &gt;&gt;&gt; target_fpr = None</span>
<span class="sd">        &gt;&gt;&gt; color = None</span>
<span class="sd">        &gt;&gt;&gt; show_operating_point = True</span>
<span class="sd">        &gt;&gt;&gt; draw_roc_curve(fpr, tpr, fnum, pnum, marker, target_tpr, target_fpr,</span>
<span class="sd">        &gt;&gt;&gt;   thresholds, color, show_operating_point)</span>
<span class="sd">        &gt;&gt;&gt; ut.show_if_requested()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
    <span class="k">if</span> <span class="n">fnum</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">next_fnum</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span> <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">is_default_dark_bg</span><span class="p">()</span> <span class="k">else</span>  <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>

    <span class="n">title_suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">target_fpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#func = scipy.interpolate.interp1d(fpr, tpr, kind=&#39;linear&#39;, assume_sorted=False)</span>
        <span class="c">#func = scipy.interpolate.interp1d(xdata, ydata, kind=&#39;nearest&#39;, assume_sorted=False)</span>
        <span class="c">#interp_vals[interp_mask] = func(pt[interp_mask])</span>
        <span class="n">target_fpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">target_fpr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">interp_tpr</span> <span class="o">=</span> <span class="n">interpolate_replbounds</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">target_fpr</span><span class="p">)</span>
        <span class="n">choice_tpr</span> <span class="o">=</span> <span class="n">interp_tpr</span>
        <span class="n">choice_fpr</span> <span class="o">=</span> <span class="n">target_fpr</span>
    <span class="k">elif</span> <span class="n">target_tpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">target_tpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">target_tpr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">interp_fpr</span> <span class="o">=</span> <span class="n">interpolate_replbounds</span><span class="p">(</span><span class="n">tpr</span><span class="p">,</span> <span class="n">fpr</span><span class="p">,</span> <span class="n">target_tpr</span><span class="p">)</span>
        <span class="n">choice_tpr</span> <span class="o">=</span> <span class="n">target_tpr</span>
        <span class="n">choice_fpr</span> <span class="o">=</span> <span class="n">interp_fpr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">choice_tpr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">choice_fpr</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">choice_fpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">choice_thresh</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">thresholds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tpr</span> <span class="o">&gt;=</span> <span class="n">choice_tpr</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">choice_thresh</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="c">#percent = ut.scalar_str(choice_tpr * 100).split(&#39;.&#39;)[0]</span>
        <span class="c">#title_suffix = &#39;, FPR%s=%05.2f%%&#39; % (percent, choice_fpr)</span>
        <span class="n">title_suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">show_operating_point</span><span class="p">:</span>
            <span class="n">title_suffix</span> <span class="o">=</span> <span class="s">&#39;, fpr=</span><span class="si">%.2f</span><span class="s">, tpr=</span><span class="si">%.2f</span><span class="s">, thresh=</span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">choice_fpr</span><span class="p">,</span> <span class="n">choice_tpr</span><span class="p">,</span> <span class="n">choice_thresh</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">title_suffix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c">#if recall_domain is None:</span>
    <span class="c">#    ave_p = np.nan</span>
    <span class="c">#else:</span>
    <span class="c">#    ave_p = p_interp.sum() / p_interp.size</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Receiver operating characteristic</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;AUC=</span><span class="si">%.3f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">roc_auc</span><span class="p">,)</span>
    <span class="n">title</span> <span class="o">+=</span> <span class="n">title_suffix</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">plot2</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
             <span class="n">x_label</span><span class="o">=</span><span class="s">&#39;False Positive Rate&#39;</span><span class="p">,</span>
             <span class="n">y_label</span><span class="o">=</span><span class="s">&#39;True Positive Rate&#39;</span><span class="p">,</span>
             <span class="n">unitbox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">flipx</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">False</span><span class="p">:</span>
        <span class="c"># Interp does not work right because of duplicate values</span>
        <span class="c"># in xdomain</span>
        <span class="n">line_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">.</span><span class="mi">11</span><span class="p">,</span> <span class="o">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c">#np.append([np.inf], np.diff(fpr)) &gt; 0</span>
        <span class="c">#np.append([np.inf], np.diff(tpr)) &gt; 0</span>
        <span class="n">unique_tpr_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tpr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unique_fpr_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">fpr</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">line_</span><span class="p">,</span>
            <span class="n">interpolate_replbounds</span><span class="p">(</span><span class="n">fpr</span><span class="p">[</span><span class="n">unique_fpr_idxs</span><span class="p">],</span> <span class="n">tpr</span><span class="p">[</span><span class="n">unique_fpr_idxs</span><span class="p">],</span>
                                   <span class="n">line_</span><span class="p">),</span> <span class="s">&#39;b-x&#39;</span><span class="p">)</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">interpolate_replbounds</span><span class="p">(</span><span class="n">tpr</span><span class="p">[</span><span class="n">unique_tpr_idxs</span><span class="p">],</span> <span class="n">fpr</span><span class="p">[</span><span class="n">unique_tpr_idxs</span><span class="p">],</span>
                                   <span class="n">line_</span><span class="p">),</span> <span class="n">line_</span><span class="p">,</span> <span class="s">&#39;r-x&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">choice_fpr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">pt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">choice_fpr</span><span class="p">,</span> <span class="n">choice_tpr</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">pt</span><span class="o">.</span><span class="n">PINK</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="draw_precision_recall_curve"><a class="viewcode-back" href="../../vtool.html#vtool.confusion.draw_precision_recall_curve">[docs]</a><span class="k">def</span> <span class="nf">draw_precision_recall_curve</span><span class="p">(</span><span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span><span class="p">,</span> <span class="n">title_pref</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">fnum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">plottool</span> <span class="kn">as</span> <span class="nn">pt</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span> <span class="k">if</span> <span class="n">pt</span><span class="o">.</span><span class="n">is_default_dark_bg</span><span class="p">()</span> <span class="k">else</span>  <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">recall_domain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">recall_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">p_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">recall_domain</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ave_p</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c"># np.nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ave_p</span> <span class="o">=</span> <span class="n">p_interp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">p_interp</span><span class="o">.</span><span class="n">size</span>

    <span class="n">pt</span><span class="o">.</span><span class="n">plot2</span><span class="p">(</span><span class="n">recall_domain</span><span class="p">,</span> <span class="n">p_interp</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;o--&#39;</span><span class="p">,</span>
              <span class="n">x_label</span><span class="o">=</span><span class="s">&#39;recall&#39;</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="s">&#39;precision&#39;</span><span class="p">,</span> <span class="n">unitbox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">flipx</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">fnum</span><span class="o">=</span><span class="n">fnum</span><span class="p">,</span> <span class="n">pnum</span><span class="o">=</span><span class="n">pnum</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s">&#39;Interplated Precision Vs Recall</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;avep = </span><span class="si">%.3f</span><span class="s">&#39;</span>  <span class="o">%</span> <span class="n">ave_p</span><span class="p">)</span>
    <span class="c">#print(&#39;Interplated Precision&#39;)</span>
    <span class="c">#print(ut.list_str(list(zip(recall_domain, p_interp))))</span>
    <span class="c">#fig.show()</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    CommandLine:</span>
<span class="sd">        python -m vtool.confusion</span>
<span class="sd">        python -m vtool.confusion --allexamples</span>
<span class="sd">        python -m vtool.confusion --allexamples --noface --nosrc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">multiprocessing</span>
    <span class="n">multiprocessing</span><span class="o">.</span><span class="n">freeze_support</span><span class="p">()</span>  <span class="c"># for win32</span>
    <span class="kn">import</span> <span class="nn">utool</span> <span class="kn">as</span> <span class="nn">ut</span>  <span class="c"># NOQA</span>
    <span class="n">ut</span><span class="o">.</span><span class="n">doctest_funcs</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jon Crall.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.1.dev1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>